# Copyright © 1995-2004, The AROS Development Team. All rights reserved.
# $Id$
#
# Static makefile rule file for AROS.

ifneq ($(AROS_TARGET_VARIANT),)
AROS_TARGET_SUFFIX=-$(AROS_TARGET_VARIANT)
else
AROS_TARGET_SUFFIX=
endif

# All files corresponding to a specific host go here.
HOSTDIR     := $(TOP)/bin/$(AROS_HOST_ARCH)-$(AROS_HOST_CPU)
TOOLDIR     := $(HOSTDIR)/tools

# All files corresponding to a specific target go here.
TARGETDIR   := $(TOP)/bin/$(AROS_TARGET_ARCH)-$(AROS_TARGET_CPU)$(AROS_TARGET_SUFFIX)

-include $(TARGETDIR)/gen/config/make.defaults
-include $(TARGETDIR)/gen/config/make.opts

# target.cfg *must* come before host.cfg
include $(TARGETDIR)/gen/config/target.cfg
include $(HOSTDIR)/gen/config/host.cfg

# Files downloaded from the net are put here
PORTSDIR    := $(TOP)/distfiles

# File for AROS gcc cross compiler spec file
SPECS       := $(TARGETDIR)/gen/config/specs

# This is the directory structure for an AROS system.
AROSDIR	             := $(TARGETDIR)/AROS

# Relative paths for standard directories
AROS_DIR_C           := C
AROS_DIR_CLASSES     := Classes
AROS_DIR_DATATYPES   := $(AROS_DIR_CLASSES)/DataTypes
AROS_DIR_GADGETS     := $(AROS_DIR_CLASSES)/Gadgets
AROS_DIR_DEVS        := Devs
AROS_DIR_LIBS        := Libs
AROS_DIR_LOCALE      := Locale
AROS_DIR_S           := S
AROS_DIR_DEVELOPMENT := Development
AROS_DIR_INCLUDE     := $(AROS_DIR_DEVELOPMENT)/include
AROS_DIR_LIB         := $(AROS_DIR_DEVELOPMENT)/lib
AROS_DIR_CONTRIB     := Extras

# Absolute paths for standard directories
AROS_C	             := $(AROSDIR)/$(AROS_DIR_C)
AROS_CLASSES	     := $(AROSDIR)/$(AROS_DIR_CLASSES)
AROS_DATATYPES       := $(AROSDIR)/$(AROS_DIR_DATATYPES)
AROS_GADGETS	     := $(AROSDIR)/$(AROS_DIR_GADGETS)
AROS_DEVS            := $(AROSDIR)/$(AROS_DIR_DEVS)
AROS_FS	             := $(AROS_DEVS)
AROS_RESOURCES       := $(AROS_DEVS)
AROS_DRIVERS         := $(AROS_DEVS)/Drivers
AROS_LIBS            := $(AROSDIR)/$(AROS_DIR_LIBS)
AROS_LOCALE          := $(AROSDIR)/$(AROS_DIR_LOCALE)
AROS_CATALOGS        := $(AROS_LOCALE)/Catalogs
AROS_HELP            := $(AROS_LOCALE)/Help
AROS_PREFS           := $(AROSDIR)/Prefs
AROS_ENVARC          := $(AROS_PREFS)/Env-Archive
AROS_S	             := $(AROSDIR)/$(AROS_DIR_S)
AROS_SYSTEM          := $(AROSDIR)/System
AROS_WANDERER        := $(AROS_SYSTEM)/Wanderer
AROS_THEMES          := $(AROS_SYSTEM)/Themes
AROS_IMAGES          := $(AROS_SYSTEM)/Images
AROS_TOOLS           := $(AROSDIR)/Tools
AROS_UTILITIES       := $(AROSDIR)/Utilities
AROS_TESTS           := $(AROSDIR)/Tests

AROS_DEVELOPMENT     := $(AROSDIR)/$(AROS_DIR_DEVELOPMENT)
AROS_INCLUDES	     := $(AROSDIR)/$(AROS_DIR_INCLUDE)
AROS_LIB             := $(AROSDIR)/$(AROS_DIR_LIB)

AROS_CONTRIB         := $(AROSDIR)/$(AROS_DIR_CONTRIB)

# The generated files all go under the GENDIR path
GENDIR               := $(TARGETDIR)/gen
SCRIPTDIR            := $(GENDIR)/scripts

MKDEPEND             := $(TOP)/scripts/mkdep
FETCH                := $(TOP)/scripts/fetch.sh
   
# The paths to the generated tools
TOOLDIR		:= $(HOSTDIR)/tools
TOOLLIB		:= $(TOOLDIR)/libtool.a
MMAKE		:= $(TOOLDIR)/mmake$(HOST_EXE_SUFFIX)
ARCHTOOL	:= $(TOOLDIR)/archtool$(HOST_EXE_SUFFIX)
GENMF		:= $(TOOLDIR)/genmf.py
FLEXCAT		:= $(TOOLDIR)/FlexCat$(HOST_EXE_SUFFIX)
FD2INLINE       := $(TOOLDIR)/fd2inline$(HOST_EXE_SUFFIX)
FD2PRAGMA       := $(TOOLDIR)/fd2pragma$(HOST_EXE_SUFFIX)
SFDC       	:= $(TOOLDIR)/sfdc$(HOST_EXE_SUFFIX)
MODTOOL		:= $(TOOLDIR)/modtool$(HOST_EXE_SUFFIX)
CREATEDTDESC	:= $(TOOLDIR)/createdtdesc$(HOST_EXE_SUFFIX)
AFSLIB		:= $(TOOLDIR)/libafs.a
COPYTOAFS	:= $(TOOLDIR)/copytoafs$(HOST_EXE_SUFFIX)
ILBMTOC		:= $(TOOLDIR)/ilbmtoc$(HOST_EXE_SUFFIX)
ILBMTOICON	:= $(TOOLDIR)/ilbmtoicon$(HOST_EXE_SUFFIX)
GENSETS         := $(TOOLDIR)/gensets$(HOST_EXE_SUFFIX)
COLLECT-AROS    := $(TOOLDIR)/collect-aros$(HOST_EXE_SUFFIX)
GENMODULE       := $(TOOLDIR)/genmodule$(HOST_EXE_SUFFIX)
GENMODULEDUMMY  := $(TOOLDIR)/genmoduledummy$(HOST_EXE_SUFFIX)
GENLIBDEFS      := $(TOOLDIR)/genlibdefs$(HOST_EXE_SUFFIX)
CXREF           := $(TOOLDIR)/cxref$(HOST_EXE_SUFFIX)

AROS_CC         := $(TARGET_CC)
AROS_AS         := $(TARGET_AS)
AROS_LD         := $(TARGET_LD)

CALL		:= env AROS_HOST_ARCH=$(AROS_HOST_ARCH) AROS_HOST_CPU=$(AROS_HOST_CPU) AROS_TARGET_ARCH=$(AROS_TARGET_ARCH) AROS_TARGET_CPU=$(AROS_TARGET_CPU) AROS_TARGET_VARIANT=$(AROS_TARGET_VARIANT)

# At the moment we have two copies of the includes...
# This is the AROS includes, minus clib/mlib.
GENINCDIR	:= $(GENDIR)/include

# Basic make configuration. No need to edit anything else under here.

.SUFFIXES :
.SUFFIXES : .c .h .d .s .S

.PHONY : all clean setup subdirs

# Was debugging enabled? Better set up the options.
ifeq ($(DEBUG),yes)
CONFIG_CFLAGS += $(DEBUG_CFLAGS)
CONFIG_AFLAGS += $(DEBUG_AFLAGS)
CONFIG_LDFLAGS += $(DEBUG_LDFLAGS)
HOST_CFLAGS += $(DEBUG_CFLAGS)
HOST_AFLAGS += $(DEBUG_AFLAGS)
HOST_LDFLAGS += $(DEBUG_LDFLAGS)
MECHO	:= $(ECHO)
else
MECHO	:= $(NOP)
endif

# C and assembly flags are set depending upon the directory
CFLAGS      = $(USER_CFLAGS) $(USER_INCLUDES) $(CONFIG_CFLAGS)
AFLAGS	    = $(USER_AFLAGS) $(CONFIG_AFLAGS)
LDFLAGS     = $(USER_LDFLAGS) $(CONFIG_LDFLAGS)

# Compatibility with old variables


OBJDIR      	:=	$(GENDIR)/$(CURDIR)
BINDIR	    	:=	$(AROSDIR)
EXEDIR	    	:=	$(AROSDIR)/C
LIBDIR	    	:=	$(AROS_LIB)
CONTRIBDIR      :=      $(AROS_CONTRIB)
OSGENDIR    	:=	$(GENDIR)/rom
KOBJSDIR        :=      $(GENDIR)/kobjs

# the build system needs to have some tools in the PATH

ifeq ($(AROS_PATH_SET),)
    PATH := $(TOOLDIR):$(TOOLDIR)/$(AROS_TARGET_CPU)-$(AROS_TARGET_ARCH)$(AROS_TARGET_SUFFIX):$(PATH)
    AROS_PATH_SET := yes
    export PATH AROS_PATH_SET
endif
