# $Id$

include $(TOP)/config/make.cfg

#MM kernel-link-emul : kernel-objs
kernel-link-emul : $(BINDIR)/aros

KLIBS   := exec boot aros dos graphics utility intuition keymap mathffp \
      	   mathieeesingbas expansion oop layers workbench cybergraphics
KDEVS   := timer input keyboard console gameport
KHNDLRS := con emul nil ram
KHIDDS  := hiddclass unixio x11gfx
KRSRCS  := battclock

KOBJS := $(addprefix $(KOBJSDIR)/,$(addsuffix _library.o ,$(KLIBS)  )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _device.o  ,$(KDEVS)  )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _handler.o ,$(KHNDLRS))) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _hidd.o    ,$(KHIDDS) )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _resource.o,$(KRSRCS) ))

DEP_LIBS := \
	$(LIBDIR)/libamiga.a \
	$(LIBDIR)/libarossupport.a

ifeq ("$(AROS_HOST_ARCH)","linux")
DEP_LIBS := $(DEP_LIBS) $(LIBDIR)/liblinux.a
endif


LIBS :=	-L$(LIBDIR) \
	-larossupport -lamiga -lhiddgraphicsstubs

ifeq ("$(AROS_HOST_ARCH)","linux")
LIBS := $(LIBS) -llinux
endif

$(BINDIR)/aros: $(GENDIR)/aros.o $(DEP_LIBS) $(KOBJS)
	$(HOST_CC) $(CFLAGS) -Dmain=submain $< $(KOBJS) $(LIBS) \
		$(GUI_LDFLAGS) $(GUI_LIBFLAGS) -o $@ $(SHELL_LDFLAGS)

$(GENDIR)/aros.o : aros.c
	$(HOST_CC) $(CFLAGS) -Dmain=submain $< -c -o $@
