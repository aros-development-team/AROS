# $Id$

include $(TOP)/config/make.cfg

#MM kernel-link-emul : kernel-objs
kernel-link-emul : $(BINDIR)/aros

#MM
kernel-link-emul-quick : kernel-link-emul

KLIBS   := exec boot aros dos graphics utility intuition keymap mathffp \
      	   mathieeesingbas expansion oop layers workbench cybergraphics
KDEVS   := timer input keyboard console gameport
KHNDLRS := con nil packet emul ram
KHIDDS  := hiddclass unixio x11gfx parallel serial
ifeq ("$(AROS_HOST_ARCH)","linux")
KHIDDS  += linux
    ifeq ("$(AROS_HOST_CPU)","i386")
	KHIDDS	+= pci pcilinux
    endif
    ifeq ("$(AROS_HOST_CPU)","x86_64")
	KHIDDS	+= pci pcilinux
    endif
endif
KRSRCS  := battclock
ifeq ($(ENABLE_DBUS),1)
KLIBS	+= dbus
endif

KOBJS := $(addprefix $(KOBJSDIR)/,$(addsuffix _library.o ,$(KLIBS)  )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _device.o  ,$(KDEVS)  )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _handler.o ,$(KHNDLRS))) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _hidd.o    ,$(KHIDDS) )) \
      	 $(addprefix $(KOBJSDIR)/,$(addsuffix _resource.o,$(KRSRCS) ))

DEP_LIBS := \
	$(LIBDIR)/libamiga.a \
	$(LIBDIR)/libarossupport.a \
	$(LIBDIR)/libhiddgraphicsstubs.a \
	$(LIBDIR)/libhiddstubs.a \
	$(LIBDIR)/libautoinit.a \
	$(LIBDIR)/liblibinit.a

LIBS :=	-L$(LIBDIR) \
	-larossupport -lhiddgraphicsstubs -lhiddstubs -lamiga -lautoinit -llibinit

USER_CFLAGS := -I$(GENINCDIR) -D__AROS__
$(BINDIR)/aros: $(GENDIR)/aros.o $(DEP_LIBS) $(KOBJS)
	$(HOST_CC) $(CFLAGS) $(HOST_LDFLAGS) -Dmain=submain $< $(KOBJS) $(LIBS) \
		$(GUI_LDFLAGS) $(GUI_LIBFLAGS) -o $@ $(KERNEL_LDFLAGS) $(DBUS_LIBFLAGS)

$(GENDIR)/aros.o : aros.c
	$(HOST_CC) $(CFLAGS) -Dmain=submain $< -c -o $@
