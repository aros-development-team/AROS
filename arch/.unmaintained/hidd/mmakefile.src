# $Id$
include $(TOP)/config/make.cfg

OS_INCLUDES	:= -I$(GENINCDIR)
GFX_INCLUDES	:= -I$(TOP)/rom/graphics -I$(TOP)/rom/cgfx
INT_INCLUDES	:= -I$(TOP)/rom/intuition
DEPS		:= $(OSGENDIR)/graphics/graphics_driver.d	\
		   $(OSGENDIR)/graphics/dispinfo.d		\
		   $(OSGENDIR)/graphics/objcache.d		\
		   $(OSGENDIR)/graphics/fakegfxhidd.d

# Need include path /usr/include before AROS includes for FreeBSD's stderr
GFX_CFLAGS	:= $(SHARED_CFLAGS) $(GFX_INCLUDES) $(CFLAGS) $(GUI_CCFLAGS)
INT_CFLAGS	:= $(SHARED_CFLAGS) $(INT_INCLUDES) $(CFLAGS) $(GUI_CCFLAGS)

# graphics.library needs to be linked to the libgraphicsstubs
# provided by gfx.hidd, so we must make sure gfx.hidd is built
# before graphics.library

#MM- kernel-graphics-linklib : hidd-graphics-linklib

#MM
graphics-gfxhidd : $(OSGENDIR)/graphics/graphics_driver.o $(OSGENDIR)/graphics/objcache.o $(OSGENDIR)/graphics/dispinfo.o $(OSGENDIR)/graphics/fakegfxhidd.o

	@$(NOP)

#MM
setup-gfxhidd :
	%mkdirs_q $(OSGENDIR)/graphics $(OSGENDIR)/intuition
	%add_objects rom/graphics/graphics_driver rom/graphics/objcache rom/graphics/dispinfo rom/graphics/fakegfxhidd

#MM
clean ::
	-$(RM) $(OSGENDIR)/graphics/graphics_driver.o \
	    $(OSGENDIR)/graphics/objcache.o \
	    $(OSGENDIR)/graphics/dispinfo.o \
	    $(OSGENDIR)/graphics/fakegfxhidd.o \
	    *.err

%mkfunctable_arch

$(OSGENDIR)/graphics/%.o: %.c
	%compile_q opt=$(GFX_CFLAGS)

$(OSGENDIR)/intuition/%.o: %.c
	%compile_q opt=$(INT_CFLAGS)

$(OSGENDIR)/graphics/%.d: %.c
	%mkdepend_q $(GFX_CFLAGS)

$(OSGENDIR)/intuition/%.d: %.c
	%mkdepend_q $(INT_CFLAGS)

%include_deps
%common
