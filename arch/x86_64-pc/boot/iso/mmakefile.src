# $Id$
include $(TOP)/config/make.cfg

.PHONY: $(DISTDIR)/aros$(AROS_TARGET_SUFFIX)-pc-x86_64.iso

TARGET_ISO := $(DISTDIR)/aros$(AROS_TARGET_SUFFIX)-pc-x86_64.iso

#MM
bootiso-pc-x86_64: $(TARGET_ISO)

#MM
bootiso-pc-x86_64-quick: $(TARGET_ISO)

.PHONY: bootiso-pc-x86_64-quick
.PHONY: $(TARGET_ISO)

ifeq ($(AROS_TARGET_BOOTLOADER),grub)
BOOTLOADER_ELTORITO_REL := $(AROS_DIR_ARCH)/grub/iso9660_stage1_5
endif

ifeq ($(AROS_TARGET_BOOTLOADER),grub2)
BOOTLOADER_ELTORITO_REL := $(AROS_DIR_ARCH)/grub/i386-pc/grub2_eltorito
endif

ifeq ($(AROS_TARGET_BOOTLOADER),grub2gfx)
BOOTLOADER_ELTORITO_REL := $(AROS_DIR_ARCH)/grub/i386-pc/grub2_eltorito
endif

MODULES_DEFAULT := $(SRCDIR)/$(CURDIR)/../modules.default
BOOTSTRAP_BOOT_FILES := bootstrap.gz
DEFAULT_BOOT_FILES := $(shell cat $(MODULES_DEFAULT))
ISO_DEPS := $(addprefix $(AROSARCHDIR)/, $(BOOTSTRAP_BOOT_FILES)) \
    $(addprefix $(AROSDIR),$(DEFAULT_BOOT_FILES))

$(warning BOOTLOADER_ELTORITO_REL = $(BOOTLOADER_ELTORITO_REL))

$(TARGET_ISO): $(ISO_DEPS)
	%mkdirs_q $(AROSDIR)/S
	@$(CP) $(SRCDIR)/workbench/s/Startup-Sequence $(AROSDIR)/S/Startup-Sequence
	@$(MKDIR) -p "$(DISTDIR)"
	@mkisofs -f \
                -o $@ \
                -b $(BOOTLOADER_ELTORITO_REL) \
                -c $(AROS_DIR_ARCH)/boot.catalog \
                -no-emul-boot \
                -boot-load-size 4 \
                -boot-info-table \
                -allow-leading-dots \
                -iso-level 4 \
                -V "AROS Live CD" \
                -publisher "The AROS Dev Team" \
                -p "The AROS Dev Team (www.aros.org)" \
                -sysid "AROS-$(AROS_TARGET_CPU)-$(AROS_TARGET_ARCH)" \
                -l -J -r \
                $(AROSDIR)

