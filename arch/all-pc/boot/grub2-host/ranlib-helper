#!/bin/sh

# This is a hack which actually allows to build GRUB2 under Darwin.
# The problem occurs because part of GRUB2 is compiled for running under Darwin (helper tools),
# and the GRUB2 itself needs to be compiled in ELF binaries. However makefiles generated by
# autoconf do not distinguish between host and target ar and runlib and use the same tool for
# both flavors.
# In most cases (when both host and target use ELF object format) this is not a problem.
# However this is not the case with Darwin, which uses Mach-O format. Darwin's ranlib fails
# to process ELF libraries and vice versa.
# The logic of this script is based on the fact that only libgnulib.a is built for ELF target.
# AR seems to be no problem, it's just an archiver.

if [ "$1" == "libgnulib.a" ]; then
    RANLIB=$AROS_TARGET_CPU-aros-ranlib
else
    RANLIB=ranlib
fi

$RANLIB $@
