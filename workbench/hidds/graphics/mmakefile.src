#$Id$
include $(TOP)/config/make.cfg

CFLAGS      := $(CFLAGS) -DAROS_USE_OOP -I.

#OS_INCLUDES := -I$(GENINCDIR)

# Sigh, this is needed because libtail.c uses <libdefs.h> not "libdefs.h"
USER_INCLUDES := -I.

# will be expand to LIBNAME.LIBPOST i.e. graphics.hidd
LIBNAME     := graphics
LIBPOST     := hidd
DESTDIR	    := $(HIDDSDIR)

OBJDIR	    := $(GENDIR)/$(CURDIR)

FILES       := GraphicsClass BM_Class GC_Class  \
               planarbm chunkybm convertpixels	\
	       gfxmode pixfmt
	       
	       
EXTRA_LIBS  := -L$(LIBDIR) -lhidd$(LIBNAME)stubs


STUBS       := $(LIBNAME)_stubs
STUB_FILE   := $(LIBDIR)/libhidd$(LIBNAME)stubs.a
STUB_OBJS   := $(foreach f,$(STUBS), $(OBJDIR)/$(f).o)

MY_INCLS    := $(wildcard include/*.h)
DEST_INC    := $(foreach f,$(MY_INCLS), $(INCDIR)/hidd/$(notdir $f))
GEN_INC	    := $(foreach f,$(MY_INCLS), $(GENINCDIR)/hidd/$(notdir $f))


ifeq ($(FLAVOUR),native)
DEPLIBS := $(LIBDIR)/libhiddgraphicsstubs.a
else
DEPLIBS := $(LIBDIR)/libhiddgraphicsstubs.a
endif

LIBS := -lhiddgraphicsstubs


#Generate the shared object
%genwblib


# Allways generate module in Sys:Hidds/

#MM- workbench-complete : workbench-hidds
#MM- workbench-hidds : hidd-graphics-module
#MM workbench-hidd-setup :
workbench-hidd-setup : setup

#MM hidd-graphics-linklib : workbench-hidd-setup includes hidd-graphics-$(ARCH)-$(CPU)
hidd-graphics-linklib : $(LIB) $(STUB_FILE)
	@$(NOP)

#MM hidd-graphics-module : workbench-hidd-setup includes hidd-graphics-$(ARCH)-$(CPU)
hidd-graphics-module : $(SLIB) $(STUB_FILE)

# --- QUICK HACKS BEGIN --- 
# These are hacks for faster execution of "mmake" and "make". Use them
# only if you know set the setup is correct and do not add them as targets
# in other makefiles.
#
# Usage: 
#   mmake AROS.hidd-graphics-quick
#   make -f TOP=/dh1/AROS CURDIR=workbench/hidds/graphics mmakefile hidd-graphics-quick



#MM hidd-graphics-module-quick : kernel-oop-$(ARCH)-$(CPU)
hidd-graphics-module-quick : $(LIB) $(SLIB)
	@$(NOP)

#MM hidd-graphics-includes-quick : hidd-oop-$(ARCH)-$(CPU)
hidd-graphics-includes-quick : setup-includes includes-copy 
	$(NOP)

# --- QUICK HACKS END ---

# create stubs-file

$(STUB_FILE) : $(STUB_OBJS)
	%mklib_q from=$(STUB_OBJS)

$(OBJDIR)/%.o : %.c	
	%compile_q	

#MM
includes-copy : $(DEST_INC) $(GEN_INC)
	@$(NOP)

$(INCDIR)/hidd/%.h : include/%.h
	$(CP) include/$(notdir $<) $@

$(GENINCDIR)/hidd/%.h : include/%.h
	$(CP) include/$(notdir $<) $@

#MM
setup-includes :
	%mkdirs_q $(GENINCDIR) $(INCDIR) $(GENINCDIR)/hidd $(INCDIR)/hidd



#MM
clean ::
	-$(RM) $(OBJDIR) *.err $(LIB) *.s


%common
