#include <proto/oop.h>
#include <hidd/graphics.h>
#include <aros/debug.h>

BOOL noisy = FALSE;

/* It's a hack anyway... */
#include "../../../test/patchrgbconv_macros.h"
#include "../../../test/patchrgbconv_rgbswap.h"
#include "../../../test/patchrgbconv_argb32.h"
#include "../../../test/patchrgbconv_bgra32.h"
#include "../../../test/patchrgbconv_rgba32.h"
#include "../../../test/patchrgbconv_abgr32.h"
#include "../../../test/patchrgbconv_rgb24.h"
#include "../../../test/patchrgbconv_bgr24.h"
#include "../../../test/patchrgbconv_rgb15.h"
#include "../../../test/patchrgbconv_bgr15.h"
#include "../../../test/patchrgbconv_rgb16.h"
#include "../../../test/patchrgbconv_bgr16.h"
#include "../../../test/patchrgbconv_rgb16oe.h"
#include "../../../test/patchrgbconv_bgr16oe.h"
#include "../../../test/patchrgbconv_rgb15oe.h"
#include "../../../test/patchrgbconv_bgr15oe.h"
#include "../../../test/patchrgbconv_xrgb32.h"
#include "../../../test/patchrgbconv_bgrx32.h"
#include "../../../test/patchrgbconv_rgbx32.h"
#include "../../../test/patchrgbconv_xbgr32.h"

typedef void (*DOFUNC)(ULONG srcfmt, ULONG dstfmt, HIDDT_RGBConversionFunction f, OOP_Object *bm);

static void installfunc(ULONG srcfmt, ULONG dstfmt, HIDDT_RGBConversionFunction f, OOP_Object *bm)
{
    struct pHidd_BitMap_SetRGBConversionFunction __m =
    {
        OOP_GetMethodID((STRPTR)CLID_Hidd_BitMap, moHidd_BitMap_SetRGBConversionFunction),
        srcfmt, dstfmt, f
    }, *m = &__m;
    OOP_DoMethod(bm, (OOP_Msg)m);
}

#define PATCHFUNC(a,b) \
    (*func)(FMT_ ## a, FMT_ ## b, convert_ ## a ## _ ## b, bitmap);

void HACK_PATCHRGBCONV(OOP_Object * bitmap)
{
    DOFUNC func = installfunc;

    #define P(a,b) PATCHFUNC(a,b)
        
	/* ARGB32 to #? */
	P(ARGB32,RGB16)   P(ARGB32,BGR16)   P(ARGB32,RGB15)   P(ARGB32,BGR15)
	P(ARGB32,BGRA32)  P(ARGB32,RGBA32)  P(ARGB32,ABGR32)  P(ARGB32,RGB24)
	P(ARGB32,BGR24)   P(ARGB32,RGB16OE) P(ARGB32,BGR16OE) P(ARGB32,RGB15OE)
	P(ARGB32,BGR15OE) P(ARGB32,XRGB32)  P(ARGB32,BGRX32)  P(ARGB32,RGBX32)
	P(ARGB32,XBGR32)

	/* BGRA32 to #? */
	P(BGRA32,RGB16)   P(BGRA32,BGR16)   P(BGRA32,RGB15)   P(BGRA32,BGR15)
	P(BGRA32,ARGB32)  P(BGRA32,RGBA32)  P(BGRA32,ABGR32)  P(BGRA32,RGB24)
	P(BGRA32,BGR24)   P(BGRA32,RGB16OE) P(BGRA32,BGR16OE) P(BGRA32,RGB15OE)
	P(BGRA32,BGR15OE) P(BGRA32,XRGB32)  P(BGRA32,BGRX32)  P(BGRA32,RGBX32)
	P(BGRA32,XBGR32)

	/* RGBA32 to #? */
	P(RGBA32,RGB16)   P(RGBA32,BGR16)   P(RGBA32,RGB15)   P(RGBA32,BGR15)
	P(RGBA32,BGRA32)  P(RGBA32,ARGB32)  P(RGBA32,ABGR32)  P(RGBA32,RGB24)
	P(RGBA32,BGR24)   P(RGBA32,RGB16OE) P(RGBA32,BGR16OE) P(RGBA32,RGB15OE)
	P(RGBA32,BGR15OE) P(RGBA32,XRGB32)  P(RGBA32,BGRX32)  P(RGBA32,RGBX32)
	P(RGBA32,XBGR32)

	/* ABGR32 to #? */
	P(ABGR32,RGB16)   P(ABGR32,BGR16)   P(ABGR32,RGB15)   P(ABGR32,BGR15)
	P(ABGR32,BGRA32)  P(ABGR32,ARGB32)  P(ABGR32,RGBA32)  P(ABGR32,RGB24)
	P(ABGR32,BGR24)   P(ABGR32,RGB16OE) P(ABGR32,BGR16OE) P(ABGR32,RGB15OE)
	P(ABGR32,BGR15OE) P(ABGR32,XRGB32)  P(ABGR32,BGRX32)  P(ABGR32,RGBX32)
	P(ABGR32,XBGR32)

	/* RGB24 to #? */
	P(RGB24,RGB16)    P(RGB24,BGR16)    P(RGB24,RGB15)    P(RGB24,BGR15)
	P(RGB24,ARGB32)   P(RGB24,BGRA32)   P(RGB24,RGBA32)   P(RGB24,ABGR32)
	P(RGB24,BGR24)    P(RGB24,RGB16OE)  P(RGB24,BGR16OE)  P(RGB24,RGB15OE)
	P(RGB24,BGR15OE)  P(RGB24,XRGB32)   P(RGB24,BGRX32)   P(RGB24,RGBX32)
	P(RGB24,XBGR32)

	/* BGR24 to #? */
	P(BGR24,RGB16)    P(BGR24,BGR16)    P(BGR24,RGB15)    P(BGR24,BGR15)
	P(BGR24,ARGB32)   P(BGR24,BGRA32)   P(BGR24,RGBA32)   P(BGR24,ABGR32)
	P(BGR24,RGB24)    P(BGR24,RGB16OE)  P(BGR24,BGR16OE)  P(BGR24,RGB15OE)
	P(BGR24,BGR15OE)  P(BGR24,XRGB32)   P(BGR24,BGRX32)   P(BGR24,RGBX32)
	P(BGR24,XBGR32)

	/* RGB15 to #? */
	P(RGB15,RGB16)    P(RGB15,BGR16)    P(RGB15,BGR15)    P(RGB15,ARGB32)
	P(RGB15,BGRA32)   P(RGB15,RGBA32)   P(RGB15,ABGR32)   P(RGB15,RGB24)
	P(RGB15,BGR24)    P(RGB15,RGB16OE)  P(RGB15,RGB15OE)  P(RGB15,BGR16OE)
	P(RGB15,BGR15OE)  P(RGB15,XRGB32)   P(RGB15,BGRX32)   P(RGB15,RGBX32)
	P(RGB15,XBGR32)

	/* BGR15 to #? */
	P(BGR15,RGB16)    P(BGR15,BGR16)    P(BGR15,RGB15)    P(BGR15,ARGB32)
	P(BGR15,BGRA32)   P(BGR15,RGBA32)   P(BGR15,ABGR32)   P(BGR15,RGB24)
	P(BGR15,BGR24)    P(BGR15,RGB16OE)  P(BGR15,RGB15OE)  P(BGR15,BGR16OE)
	P(BGR15,BGR15OE)  P(BGR15,XRGB32)   P(BGR15,BGRX32)   P(BGR15,RGBX32)
	P(BGR15,XBGR32)

	/* RGB16 to #? */
	P(RGB16,RGB15)    P(RGB16,BGR16)    P(RGB16,BGR15)    P(RGB16,ARGB32)
	P(RGB16,BGRA32)   P(RGB16,RGBA32)   P(RGB16,ABGR32)   P(RGB16,RGB24)
	P(RGB16,BGR24)    P(RGB16,RGB16OE)  P(RGB16,RGB15OE)  P(RGB16,BGR16OE)
	P(RGB16,BGR15OE)  P(RGB16,XRGB32)   P(RGB16,BGRX32)   P(RGB16,RGBX32)
	P(RGB16,XBGR32)

	/* BGR16 to #? */
	P(BGR16,RGB15)    P(BGR16,RGB16)    P(BGR16,BGR15)    P(BGR16,ARGB32)
	P(BGR16,BGRA32)   P(BGR16,RGBA32)   P(BGR16,ABGR32)   P(BGR16,RGB24)
	P(BGR16,BGR24)    P(BGR16,RGB16OE)  P(BGR16,RGB15OE)  P(BGR16,BGR16OE)
	P(BGR16,BGR15OE)  P(BGR16,XRGB32)   P(BGR16,BGRX32)   P(BGR16,RGBX32)
	P(BGR16,XBGR32)

	/* RGB16OE to #? */
	P(RGB16OE,RGB16)   P(RGB16OE,RGB15)  P(RGB16OE,BGR16)   P(RGB16OE,BGR15)
	P(RGB16OE,ARGB32)  P(RGB16OE,BGRA32) P(RGB16OE,RGBA32)  P(RGB16OE,ABGR32)
	P(RGB16OE,RGB24)   P(RGB16OE,BGR24)  P(RGB16OE,RGB15OE) P(RGB16OE,BGR16OE)
	P(RGB16OE,BGR15OE) P(RGB16OE,XRGB32) P(RGB16OE,BGRX32)  P(RGB16OE,RGBX32)
	P(RGB16OE,XBGR32)

	/* BGR16OE to #? */
	P(BGR16OE,RGB16)   P(BGR16OE,RGB15)  P(BGR16OE,BGR16)   P(BGR16OE,BGR15)
	P(BGR16OE,ARGB32)  P(BGR16OE,BGRA32) P(BGR16OE,RGBA32)  P(BGR16OE,ABGR32)
	P(BGR16OE,RGB24)   P(BGR16OE,BGR24)  P(BGR16OE,RGB15OE) P(BGR16OE,RGB16OE)
	P(BGR16OE,BGR15OE) P(BGR16OE,XRGB32) P(BGR16OE,BGRX32)  P(BGR16OE,RGBX32)
	P(BGR16OE,XBGR32)

	/* RGB15OE to #? */
	P(RGB15OE,RGB16)   P(RGB15OE,RGB15)  P(RGB15OE,BGR16)   P(RGB15OE,BGR15)
	P(RGB15OE,ARGB32)  P(RGB15OE,BGRA32) P(RGB15OE,RGBA32)  P(RGB15OE,ABGR32)
	P(RGB15OE,RGB24)   P(RGB15OE,BGR24)  P(RGB15OE,RGB16OE) P(RGB15OE,BGR16OE)
	P(RGB15OE,BGR15OE) P(RGB15OE,XRGB32) P(RGB15OE,BGRX32)  P(RGB15OE,RGBX32)
	P(RGB15OE,XBGR32)

	/* BGR15OE to #? */
	P(BGR15OE,RGB16)   P(BGR15OE,RGB15)  P(BGR15OE,BGR16)   P(BGR15OE,BGR15)
	P(BGR15OE,ARGB32)  P(BGR15OE,BGRA32) P(BGR15OE,RGBA32)  P(BGR15OE,ABGR32)
	P(BGR15OE,RGB24)   P(BGR15OE,BGR24)  P(BGR15OE,RGB16OE) P(BGR15OE,BGR16OE)
	P(BGR15OE,RGB15OE) P(BGR15OE,XRGB32) P(BGR15OE,BGRX32)  P(BGR15OE,RGBX32)
	P(BGR15OE,XBGR32)

	/* XRGB32 to #? */
	P(XRGB32,RGB16)   P(XRGB32,BGR16)   P(XRGB32,RGB15)   P(XRGB32,BGR15)
	P(XRGB32,ARGB32)  P(XRGB32,BGRA32)  P(XRGB32,RGBA32)  P(XRGB32,ABGR32)
	P(XRGB32,RGB24)   P(XRGB32,BGR24)   P(XRGB32,RGB16OE) P(XRGB32,BGR16OE)
	P(XRGB32,RGB15OE) P(XRGB32,BGR15OE) P(XRGB32,BGRX32)  P(XRGB32,RGBX32)
	P(XRGB32,XBGR32)

	/* BGRX32 to #? */
	P(BGRX32,RGB16)   P(BGRX32,BGR16)   P(BGRX32,RGB15)   P(BGRX32,BGR15)
	P(BGRX32,ARGB32)  P(BGRX32,BGRA32)  P(BGRX32,RGBA32)  P(BGRX32,ABGR32)
	P(BGRX32,RGB24)   P(BGRX32,BGR24)   P(BGRX32,RGB16OE) P(BGRX32,BGR16OE)
	P(BGRX32,RGB15OE) P(BGRX32,BGR15OE) P(BGRX32,XRGB32)  P(BGRX32,RGBX32)
	P(BGRX32,XBGR32)

	/* RGBX32 to #? */
	P(RGBX32,RGB16)   P(RGBX32,BGR16)   P(RGBX32,RGB15)   P(RGBX32,BGR15)
	P(RGBX32,BGRA32)  P(RGBX32,ARGB32)  P(RGBX32,ABGR32)  P(RGBX32,RGBA32)
	P(RGBX32,RGB24)   P(RGBX32,BGR24)   P(RGBX32,RGB16OE) P(RGBX32,BGR16OE)
	P(RGBX32,RGB15OE) P(RGBX32,BGR15OE) P(RGBX32,XRGB32)  P(RGBX32,BGRX32)
	P(RGBX32,XBGR32)

	/* XBGR32 to #? */
	P(XBGR32,RGB16)   P(XBGR32,BGR16)   P(XBGR32,RGB15)   P(XBGR32,BGR15)
	P(XBGR32,BGRA32)  P(XBGR32,ARGB32)  P(XBGR32,RGBA32)  P(XBGR32,ABGR32)
	P(XBGR32,RGB24)   P(XBGR32,BGR24)   P(XBGR32,RGB16OE) P(XBGR32,BGR16OE)
	P(XBGR32,RGB15OE) P(XBGR32,BGR15OE) P(XBGR32,XRGB32)  P(XBGR32,BGRX32)
	P(XBGR32,RGBX32)    
}
