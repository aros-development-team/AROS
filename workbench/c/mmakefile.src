# Copyright © 2003-2010, The AROS Development Team. All rights reserved.
# $Id$

include $(TOP)/config/make.cfg

FILES := \
    AddBuffers \
    AddDatatypes \
    Avail \
    Break \
    ChangeTaskPri \
    CheckMem \
    ConClip \
    CopyToPAR \
    CRList \
    DamageList \
    Date \
    Delete \
    DevList \
    DiskChange \
    Eject \
    Eval \
    Filenote \
    IconX \
    Info \
    Install \
    install-i386-pc \
    Install-grub2-i386-pc \
    Join \
    LeakWatch \
    LibList \
    List \
    Load \
    Lock \
    MakeDir \
    MakeLink \
    Mount \
    Protect \
    Reboot \
    Relabel \
    Rename \
    RequestChoice \
    RequestFile \
    ResList \
    Search \
    SetClock \
    SetDate \
    SetDefaultFont \
    SetLocale \
    Shutdown \
    Sort \
    StackSnoop \
    TaskList \
    Touch \
    Type \
    UUIDGen \
    Version \
    Wait \
    WaitForPort \
    Which \
    Delay

PURE_FILES := \
    Assign \
    Beep \
    Copy \
    Debug \
    Dir \
    GfxControl \
    LoadMonDrvs \
    SetKeyboard \
    WaitX
#   ISApnp

USER_CFLAGS     := -I$(SRCDIR)/rom/dos -DADATE="\"$(shell date "+%d.%m.%Y")\""

#MM- workbench : workbench-c
#MM- workbench-quick : workbench-c-quick

#MM workbench-c : includes linklibs workbench-c-pure workbench-c-requeststring workbench-libs-uuid
#MM workbench-c-quick : workbench-c-pure-quick workbench-c-requeststring-quick

%build_progs mmake=workbench-c \
    files=$(FILES) targetdir=$(AROS_C) \
    uselibs="uuid arossupport amiga arosc m debug"

%build_progs mmake=workbench-c-pure \
    files=$(PURE_FILES) targetdir=$(AROS_C) \
    uselibs="arossupport amiga rom m" usestartup=no

%build_prog mmake=workbench-c-requeststring progname=RequestString \
    files=RequestString targetdir=$(AROS_C) \
    uselibs="arossupport amiga rom mui"

$(OBJDIR)/evalParser.tab.c : evalParser.y
	@$(ECHO) Generating $(notdir $@) from $<...
	@$(BISON) -o $@ $<

$(OBJDIR)/Eval.o : $(OBJDIR)/evalParser.tab.c $(SRCDIR)/$(CURDIR)/Eval.c
	%compile_q from=$(SRCDIR)/$(CURDIR)/Eval.c opt="$(CFLAGS) -I$(OBJDIR)"

$(OBJDIR)/Load.o : $(OBJDIR)/Eject.o
	@$(ECHO) Copying $< to $@
	@$(CP) $< $@

%common
